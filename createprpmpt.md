重新设计整个项目设计

1. 数据来源有两种，内置的爬虫（针对指定的初始化链接），根据固定的网页链接pattern（才能解析），有自己的数据库，通过 网页正文提取算法 ，提取内容

2. 提取内容，通过大模型直接一个prompt进行实体提取以及实体和实体之间的关系提取，以及实体发生的新闻事件；

3. 通过定时任务，定期对任务内容的命名实体和关系重复的进行合并；

4. 可以外部可以提交新闻的接口，用步骤 2 步骤3 来进行处理

使用框架 fastapi + sqlite + langchain + langgraph + sqlcharmy 等成熟组建，先帮我思考整体设计文档，要求作为大厂资深15年员工，进行设计文档 ，对需求进行拆解以及合理性的扩展。 对文档重复迭代3次，不断优化。要求整体轻量化，代码风格符合大厂规范。





# 实体关系抽取与知识图谱构建系统设计文档

## 1. 项目概述

设计并实现一个轻量化实体关系抽取与知识图谱构建系统，该系统能够通过内置爬虫获取指定网页内容，利用大模型进行实体与关系抽取，并通过定时任务持续优化知识图谱数据，同时提供外部新闻提交接口实现数据扩展。

## 2. 技术架构设计

采用以下技术栈构建系统：

- Web框架：FastAPI（提供高性能API服务）

- 数据库：SQLite（轻量化关系型数据库）

- 大模型集成：LangChain（大模型调用与提示词管理）

- 工作流管理：LangGraph（构建抽取与处理工作流）

- ORM：SQLAlchemy（数据库交互层）

- 爬虫：内置定制化网页爬虫模块

- 定时任务：APScheduler（任务调度系统）

## 3. 功能模块详细设计

### 3.1 数据采集模块

- 实现基于规则的网页爬虫系统，支持指定初始化链接

- 开发网页链接Pattern匹配引擎，仅对符合规则的URL进行解析

- 集成网页正文提取算法，精准提取网页核心内容

- 设计爬虫速率限制与重试机制，避免请求过于频繁

- 实现爬虫状态管理，支持断点续爬

### 3.2 实体与关系抽取模块

- 设计大模型抽取提示词模板，支持实体识别、关系抽取和事件提取

- 构建基于LangGraph的抽取工作流，包含内容预处理、实体抽取、关系抽取、事件提取等节点

- 实现抽取结果验证机制，过滤低置信度结果

- 设计抽取结果标准化处理，统一实体与关系格式

### 3.3 知识图谱管理模块

- 设计实体与关系数据模型，支持实体属性扩展

- 实现实体去重与合并算法，处理重复实体

- 开发关系冲突检测与解决机制

- 提供知识图谱查询接口，支持实体、关系、事件多维度查询

### 3.4 定时任务模块

- 实现基于APScheduler的定时任务系统

- 配置实体与关系定期合并任务，支持自定义执行频率

- 开发爬虫定时采集任务，定期更新数据

- 设计任务执行状态监控与日志记录

### 3.5 API接口模块

- 开发外部新闻提交接口，支持URL与文本内容提交

- 实现接口权限控制机制

- 设计请求限流与负载保护

- 提供完善的API文档与错误处理

## 4. 数据库设计

- 设计爬虫任务表：存储爬虫任务配置与状态

- 实现网页内容表：存储原始网页内容与元数据

- 设计实体表：存储抽取的实体信息

- 实现关系表：存储实体间关系

- 开发事件表：存储实体相关事件

- 设计任务调度表：存储定时任务配置

## 5. 系统交互流程

1. 数据采集流程：初始化链接→链接过滤→网页下载→正文提取→内容存储

2. 抽取流程：内容加载→预处理→实体抽取→关系抽取→事件提取→结果存储

3. 知识图谱优化流程：定时触发→实体相似度计算→实体合并→关系整理→事件关联

4. 外部提交流程：API请求→权限验证→内容处理→抽取流程→结果存储

## 6. 性能与安全设计

- 实现请求缓存机制，减少重复计算

- 设计数据库索引，优化查询性能

- 开发系统监控接口，实时监控系统运行状态

- 实现接口请求频率限制，防止恶意请求

- 设计数据备份与恢复机制

## 7. 项目实施计划

### 迭代1：基础功能实现

- 完成系统架构搭建

- 实现基础爬虫功能

- 开发简单实体与关系抽取

- 设计基础数据库模型

- 实现核心API接口

### 迭代2：功能完善与优化

- 优化网页正文提取算法

- 完善实体与关系抽取逻辑

- 实现实体合并功能

- 开发定时任务系统

- 完善错误处理与日志记录

### 迭代3：系统优化与扩展

- 优化抽取准确率

- 提升系统性能

- 完善监控与告警机制

- 开发数据导出功能

- 编写系统文档与使用手册

## 8. 代码规范与质量保障

- 遵循PEP 8 Python代码规范

- 实现模块化与组件化设计，提高代码复用性

- 编写单元测试，核心模块测试覆盖率不低于80%

- 实现代码静态检查与自动格式化

- 设计CI/CD流程，支持自动测试与部署

- 编写详细的代码注释与文档

## 9. 扩展性设计

- 预留多数据源接入接口

- 设计大模型替换机制，支持不同模型切换

- 预留知识图谱可视化接口

- 支持实体属性自定义扩展

## 10. 风险评估与应对策略

- 大模型API调用不稳定：实现本地缓存与重试机制

- 网页结构变化导致抽取失败：设计自适应网页解析方案

- 数据量增长导致性能下降：实现数据分片与索引优化

- 抽取结果质量不高：设计人工审核与反馈机制

本设计文档将作为项目开发的基础，后续将根据实际开发情况进行三次迭代优化，不断完善系统设计。