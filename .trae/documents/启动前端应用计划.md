## 修复前端API调用计划

### 1. 问题分析
- **错误原因**：前端发送的请求中包含了字符串"null"作为查询参数，而不是真正的null值
- **错误信息**：`请求失败 (尝试 1/3): HTTP 422: Unprocessable Content`
- **具体请求**：`GET /api/kg/entities?page=1&page_size=10&search=null&entity_type=null&sort_by=created_at&sort_order=desc`
- **根本原因**：使用URLSearchParams时，null值会被转换为字符串"null"，导致后端验证失败

### 2. 解决方案

#### 步骤1：修复api.js中的URLSearchParams使用
修改`api.js`文件，确保在构建查询参数时：
- 只包含非null、非undefined的参数
- 或者将null值转换为undefined，这样URLSearchParams就不会包含这些参数

#### 步骤2：修复所有API调用
检查并修复所有使用URLSearchParams的地方，确保参数格式正确

#### 步骤3：测试修复效果
- 重启前端服务
- 访问前端应用，检查控制台日志
- 确保API请求返回200 OK，不再出现422错误

### 3. 具体实现

#### 3.1 修改api.js文件
```javascript
// 修复URLSearchParams构建
const finalParams = { ...defaultParams, ...params };
const queryParams = new URLSearchParams();

// 只添加非null、非undefined的参数
Object.entries(finalParams).forEach(([key, value]) => {
    if (value !== null && value !== undefined) {
        queryParams.append(key, value);
    }
});

const queryString = queryParams.toString();
```

#### 3.2 修复所有API方法
对`api.js`中的所有API方法应用相同的修复，确保参数格式正确

### 4. 预期结果
- 前端API请求不再包含字符串"null"作为查询参数
- 后端API返回200 OK，不再出现422错误
- 前后端通信正常
- 前端应用能够正常加载和运行

### 5. 注意事项
- 确保所有API方法都应用了相同的修复
- 测试所有API端点，确保它们都能正常工作
- 可以通过浏览器控制台查看修复后的请求URL，确认参数格式正确

通过这个计划，我们可以修复前端API调用的参数格式问题，确保前后端接口对齐，不再出现422错误。